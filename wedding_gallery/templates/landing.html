{% extends 'base.html' %}

{% block navbar %}
<!-- Custom Transparent Navbar for Landing Page -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top p-4"
    style="background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);">
    <div class="container-fluid">
        <a class="navbar-brand text-uppercase fw-bold" href="#" style="letter-spacing: 2px;">Wedding Gallery</a>
        <div class="d-flex align-items-center ms-auto">
            <a href="{% url 'accounts:guest_login' %}" class="btn btn-outline-light rounded-pill px-4">Enter Gallery</a>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<style>
    .hero-section {
        height: 100vh;
        width: 100%;
        position: relative;
        overflow: hidden;
        background-color: #000;
        /* Fallback */
    }

    .carousel-item-bg {
        height: 100vh;
        width: 100%;
        background-size: cover;
        background-position: center;
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0;
        transition: opacity 1.5s ease-in-out;
        z-index: 0;
    }

    .carousel-item-bg.active {
        opacity: 1;
    }

    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        z-index: 1;
    }

    .big-title {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 15vw;
        font-weight: 700;
        color: rgba(255, 255, 255, 0.9);
        text-transform: uppercase;
        letter-spacing: 10px;
        z-index: 2;
        text-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        width: 100%;
        text-align: center;
        pointer-events: none;
    }

    .bottom-cards {
        position: absolute;
        bottom: 50px;
        left: 50px;
        display: flex;
        gap: 20px;
        z-index: 3;
    }

    .glass-card {
        width: 180px;
        height: 250px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        color: white;
        transition: transform 0.3s ease, background 0.3s;
        cursor: pointer;
        overflow: hidden;
        position: relative;
    }

    .glass-card:hover {
        transform: translateY(-10px);
        background: rgba(255, 255, 255, 0.2);
    }

    .glass-card img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
        opacity: 0.7;
        transition: opacity 0.3s;
    }

    .glass-card:hover img {
        opacity: 0.9;
    }

    .glass-card h5 {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 5px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .glass-card p {
        font-size: 0.8rem;
        margin-bottom: 0;
        opacity: 0.9;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .enter-btn-container {
        position: absolute;
        bottom: 50px;
        right: 50px;
        z-index: 3;
    }

    .enter-btn-lg {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: white;
        padding: 15px 40px;
        font-size: 1.5rem;
        border-radius: 50px;
        text-decoration: none;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .enter-btn-lg:hover {
        background: white;
        color: black;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
        .big-title {
            font-size: 18vw;
            top: 30%;
        }

        .bottom-cards {
            left: 20px;
            bottom: 120px;
            overflow-x: auto;
            width: calc(100% - 40px);
            padding-bottom: 10px;
        }

        .glass-card {
            min-width: 140px;
            height: 200px;
        }

        .enter-btn-container {
            bottom: 40px;
            right: 50%;
            transform: translateX(50%);
            width: 100%;
            text-align: center;
        }
    }
</style>

<div class="hero-section">
    <!-- Background Carousel -->
    <div id="heroCarousel">
        {% for photo in carousel_photos %}
        <div class="carousel-item-bg {% if forloop.first %}active{% endif %}"
            style="background-image: url('{{ photo.image_url }}');">
        </div>
        {% empty %}
        <!-- Fallback if no photos -->
        <div class="carousel-item-bg active"
            style="background-image: url('https://images.unsplash.com/photo-1511285560982-1927bb5a61b9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');">
        </div>
        {% endfor %}
    </div>

    <div class="hero-overlay"></div>

    <div class="big-title">WEDDING</div>

    <div class="bottom-cards">
        {% for photo in card_photos %}
        <div class="glass-card">
            <img src="{{ photo.image_url }}" alt="{{ photo.title }}">
            <h5>{{ photo.title|default:"Moment" }}</h5>
            <p>{{ photo.uploaded_at|date:"M d" }}</p>
        </div>
        {% empty %}
        <!-- Fallback Cards -->
        <div class="glass-card">
            <img src="https://images.unsplash.com/photo-1519741497674-611481863552?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
                alt="Ceremony">
            <h5>Ceremony</h5>
            <p>The Vows</p>
        </div>
        <div class="glass-card">
            <img src="https://images.unsplash.com/photo-1519225468359-2996bc01c34c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
                alt="Reception">
            <h5>Reception</h5>
            <p>Party Time</p>
        </div>
        {% endfor %}
    </div>

    <div class="enter-btn-container">
        <a href="{% url 'accounts:guest_login' %}" class="enter-btn-lg">Enter Gallery</a>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    // Simple Vanilla JS Carousel for Hero
    document.addEventListener('DOMContentLoaded', function () {
        const slides = document.querySelectorAll('.carousel-item-bg');
        if (slides.length > 1) {
            let currentSlide = 0;
            setInterval(() => {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000); // Change every 5 seconds
        }

        // GSAP 3D Carousel Animation
        const ring = document.querySelector(".carousel-3d-ring");
        if (ring) {
            // Create the rotation tween
            const rotationTween = gsap.to(ring, {
                rotationY: 360,
                duration: 20,
                repeat: -1,
                ease: "none"
            });
        }
    });
</script>

<!-- 3D Carousel Section -->
<section class="py-5 overflow-hidden"
    style="background: #111; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;">
    <div class="container text-center mb-5">
        <h2 class="display-4 fw-bold text-white mb-3" style="letter-spacing: 2px;">CAPTURED MOMENTS</h2>
        <p class="text-white-50">A glimpse into our beautiful journey</p>
    </div>

    <div class="carousel-3d-container">
        <div class="carousel-3d-ring">
            {% for photo in carousel_photos %}
            <div class="carousel-3d-item" style="--i: {{ forloop.counter }}; --total: {{ carousel_photos|length }};">
                <img src="{{ photo.image_url }}" alt="{{ photo.title }}">
            </div>
            {% empty %}
            <!-- Fallback Items if no photos -->
            {% for i in "12345678"|make_list %}
            <div class="carousel-3d-item" style="--i: {{ forloop.counter }}; --total: 8;">
                <img src="https://images.unsplash.com/photo-1519741497674-611481863552?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
                    alt="Fallback">
            </div>
            {% endfor %}
            {% endfor %}
        </div>
    </div>
</section>

<style>
    .carousel-3d-container {
        position: relative;
        width: 100%;
        height: 400px;
        perspective: 1000px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .carousel-3d-ring {
        position: relative;
        width: 300px;
        height: 200px;
        transform-style: preserve-3d;
        /* Animation handled by GSAP */
    }

    .carousel-3d-item {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform-origin: center;
        /* Calculate rotation based on index and total items */
        transform: rotateY(calc(360deg / var(--total) * var(--i))) translateZ(500px);
        -webkit-box-reflect: below 10px linear-gradient(transparent, transparent, rgba(0, 0, 0, 0.4));
    }

    .carousel-3d-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        border: 2px solid rgba(255, 255, 255, 0.1);
    }
</style>

<!-- Scattered Grid Section -->
<section class="py-5 position-relative" style="background: #1a1a1a; overflow: hidden;">
    <div class="container py-5">
        <div class="scattered-grid">
            <!-- Top Row Images -->
            <div class="grid-item item-1">
                <img src="{{ scattered_photos.0.image_url|default:'https://images.unsplash.com/photo-1511285560982-1927bb5a61b9?w=400' }}"
                    alt="Wedding Moment">
            </div>
            <div class="grid-item item-2">
                <img src="{{ scattered_photos.1.image_url|default:'https://images.unsplash.com/photo-1519741497674-611481863552?w=400' }}"
                    alt="Wedding Moment">
            </div>
            <div class="grid-item item-3">
                <img src="{{ scattered_photos.2.image_url|default:'https://images.unsplash.com/photo-1515934751635-c81c6bc9a2d8?w=400' }}"
                    alt="Wedding Moment">
            </div>
            <div class="grid-item item-4">
                <img src="{{ scattered_photos.3.image_url|default:'https://images.unsplash.com/photo-1465495976277-4387d4b0b4c6?w=400' }}"
                    alt="Wedding Moment">
            </div>

            <!-- Central Text -->
            <div class="grid-text text-center">
                <span
                    class="badge bg-light text-dark rounded-pill px-3 py-2 mb-3 text-uppercase tracking-wider">Testimonials</span>
                <h2 class="display-4 fw-bold text-white mb-2">Trusted by Couples</h2>
                <h3 class="display-6 text-white-50">from various traditions</h3>
            </div>

            <!-- Bottom Row Images -->
            <div class="grid-item item-5">
                <img src="{{ scattered_photos.4.image_url|default:'https://images.unsplash.com/photo-1520854221250-858f27636722?w=400' }}"
                    alt="Wedding Moment">
            </div>
            <div class="grid-item item-6">
                <img src="{{ scattered_photos.5.image_url|default:'https://images.unsplash.com/photo-1522673607200-1645062cd958?w=400' }}"
                    alt="Wedding Moment">
            </div>
            <div class="grid-item item-7">
                <img src="{{ scattered_photos.6.image_url|default:'https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=400' }}"
                    alt="Wedding Moment">
            </div>
            <div class="grid-item item-8">
                <img src="{{ scattered_photos.7.image_url|default:'https://images.unsplash.com/photo-1523438885200-e635ba2c371e?w=400' }}"
                    alt="Wedding Moment">
            </div>
        </div>
    </div>
</section>

<style>
    .scattered-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto auto auto;
        gap: 2rem;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
    }

    .grid-text {
        grid-column: 2 / span 2;
        grid-row: 2;
        z-index: 10;
        padding: 2rem;
    }

    .grid-item {
        position: relative;
        border-radius: 16px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .grid-item:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        z-index: 5;
    }

    .grid-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        aspect-ratio: 1/1;
        /* Square aspect ratio for uniformity */
    }

    /* Positioning logic to create the "scattered" look */
    .item-1 {
        grid-column: 1;
        grid-row: 1;
        transform: rotate(-3deg);
    }

    .item-2 {
        grid-column: 2;
        grid-row: 1;
        transform: translateY(20px);
    }

    .item-3 {
        grid-column: 3;
        grid-row: 1;
        transform: translateY(-10px);
    }

    .item-4 {
        grid-column: 4;
        grid-row: 1;
        transform: rotate(3deg);
    }

    .item-5 {
        grid-column: 1;
        grid-row: 2 / span 2;
        align-self: end;
        transform: rotate(2deg);
    }

    .item-6 {
        grid-column: 4;
        grid-row: 2 / span 2;
        align-self: end;
        transform: rotate(-2deg);
    }

    .item-7 {
        grid-column: 2;
        grid-row: 3;
        transform: translateY(-30px);
    }

    .item-8 {
        grid-column: 3;
        grid-row: 3;
        transform: translateY(-10px);
    }

    /* Responsive adjustments */
    @media (max-width: 992px) {
        .scattered-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .grid-text {
            grid-column: 1 / -1;
            grid-row: 1;
            margin-bottom: 2rem;
        }

        .grid-item {
            grid-column: auto !important;
            grid-row: auto !important;
            transform: none !important;
        }
    }
</style>
{% endblock %}